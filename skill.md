# 文件整理技?

## 概述
帮助用户整理和分类文件，创建结构化的文件夹，按指定规则复制、分类和重命名文件，同时保留原始文件不变?

## 触发条件
当用户需要：
- 整理杂乱的文件目?
- 按规则批量重命名文件
- 按类别（类型、大小、日期等）分类文?
- 创建文件备份并整?

## 输入参数
通过交互式询问获取以下信息：

### 必需参数
- **源文件夹路径**：需要整理的文件所在目?
- **目标文件夹路?*：整理后存放文件的目录（默认为当前目录下的新文件夹）

### 可选参?
- **分类方式**?
  - 按扩展名（如：jpg, pdf, docx?
  - 按文件大小（如：<1MB, 1-10MB, >10MB?
  - 按修改日期（如：2024-01, 2024-02?
  - 按文件名前缀
- **重命名方?*?
  - 追加日期时间?
    - **时间戳格?*：`YYYYMMDD_HHMMSS`（如：report_20240128_143022.txt?
    - 时间来源：使用文件修改时间或当前时间（询问用户选择?
  - 追加序号（如：photo_001.jpg, photo_002.jpg?
    - **序号规则**：询问用户是全局编号还是每个分类独立编号
      - 全局编号：所有文件从 001 开始递增
      - 分类独立编号：每个分类文件夹内从 001 开?
  - 追加日期时间?+ 序号（如：report_20240128_143022_001.txt?
  - 保持原文件名
- **复制或移?*?
  - 复制（保留原文件?
  - 移动（删除原文件，默认复制）
- **文件冲突处理**?
  - 跳过（默认）
  - 覆盖
  - 自动重命?
  - 询问用户

## 执行步骤

### 1. 确认参数
```
请提供以下信息：
- 源文件夹路径：[从用户获取或使用当前目录]
- 目标文件夹名称：[从用户获取或默认?"organized_files"]
- 分类方式：[从用户获取或默认为扩展名]
- 重命名方式：[从用户获取或默认为不重命名]
  - 如果选择序号，询问：全局编号或分类独立编号？
- 操作类型：[从用户获取或默认为复制]
- 文件冲突处理：[从用户获取或默认为跳过]
```

### 2. 验证源目?
使用 `ls` 命令检查源目录是否存在及其内容?
```bash
ls -la [源目录路径]
```

### 3. 创建目标结构
根据选择的分类方式创建子文件夹：
```bash
mkdir -p [目标目录]/[分类1]
mkdir -p [目标目录]/[分类2]
...
```

### 4. 复制和整理文?
遍历源目录中的所有文件，根据分类规则和重命名规则进行处理?

**按扩展名分类映射表：**
- 图片文件 ?`images/`
  - jpg, jpeg, png, gif, bmp, svg, webp, ico, tiff
- 文档文件 ?`documents/`
  - pdf, doc, docx, txt, rtf, odt, xls, xlsx, ppt, pptx, csv
- 视频文件 ?`videos/`
  - mp4, avi, mkv, mov, wmv, flv, webm, m4v
- 音频文件 ?`audio/`
  - mp3, wav, flac, aac, ogg, m4a, wma
- 压缩文件 ?`archives/`
  - zip, rar, 7z, tar, gz, bz2
- 代码文件 ?`code/`
  - py, js, ts, html, css, java, cpp, c, h, php, rb, go, rs, json, xml, yaml, sql
- 其他文件 ?`others/`
  - 不在上述列表中的文件

**按文件大小分类映射表?*
- 极小文件 (<100KB) ?`tiny/`
- 小文?(100KB-1MB) ?`small/`
- 中文?(1MB-10MB) ?`medium/`
- 大文?(10MB-100MB) ?`large/`
- 超大文件 (>100MB) ?`huge/`

**按修改日期分类映射表?*
按月分类（默认）?
- 2024-01 ?`2024/01/`
- 2024-02 ?`2024/02/`
- ...
- ?月格式的嵌套目录结构

按年分类?
- 2023 ?`2023/`
- 2024 ?`2024/`
- 2025 ?`2025/`

按季度分类：
- 2024-Q1 ?`2024/Q1/`
- 2024-Q2 ?`2024/Q2/`
- ...

按日期粒度选项?
询问用户选择：年 / ?/ ?/ 季度

**按文件名前缀分类映射表：**
自动提取文件名前缀，按相似性分组：

**规则1：按分隔符提?*
- `_` 下划线分隔：`report_2024_final.pdf` ?`report/`
- `-` 连字符分隔：`project-alpha-v1.txt` ?`project/`
- `.` 点分隔：`image.thumbnail.jpg` ?`image/`

**规则2：按首字母分?*
- A 开??`A/`
- B 开??`B/`
- ...
- Z 开??`Z/`
- 数字开??`0-9/`
- 其他字符开??`others/`

**规则3：按自定义前缀**
用户提供前缀列表，自动匹配：
- 用户输入前缀：`photo`, `doc`, `music`
- `photo_001.jpg` ?`photo/`
- `document.pdf` ?`doc/`
- `music_song.mp3` ?`music/`
- `unknown.txt` ?`others/`

**实现逻辑（按文件名前缀）：**
```bash
# 提取前缀（按下划线分隔）
extract_prefix() {
    local filename="$1"
    # 移除扩展?
    local base="${filename%.*}"
    # 按第一个下划线分割
    local prefix="${base%%_*}"
    echo "$prefix"
}

# 使用示例
filename="report_2024_final.pdf"
prefix=$(extract_prefix "$filename")  # 返回 "report"
目标目录="$prefix/"  # ?"report/"
```

### 5. 处理文件
对于每个文件?
1. 确定目标子目?
2. 根据重命名规则生成新文件?
3. 使用 `cp`（复制）?`mv`（移动）命令操作文件

### 6. 验证结果
展示整理后的目录结构和操作摘要：
```
?已整?15 个文?
?创建?3 个分类文件夹
?复制了文件到 [目标目录]
```

## 错误处理

### 常见问题
1. **源目录不存在**：提示用户确认路径并重新输入
2. **目标目录已存?*：询问用户是否覆盖或使用新名?
3. **文件名冲?*：在重命名时检查目标文件是否存在，避免覆盖
4. **权限不足**：告知用户权限问题，建议使用有权限的目录

### 文件名冲突处理策?

当目标文件已存在时，采用以下策略?

**选项1：跳过（默认?*
```
目标文件 "images/photo_001.jpg" 已存在，跳过
```

**选项2：覆?*
```
目标文件 "images/photo_001.jpg" 已存在，将被覆盖
```

**选项3：自动重命名**
```
目标文件 "images/photo.jpg" 已存?
自动重命名为 "images/photo_1.jpg"
```

**自动重命名规则：**
1. 尝试添加后缀 `_1`, `_2`, `_3`... 直到找到可用文件?
2. 示例：`photo.jpg` ?`photo_1.jpg` ?`photo_2.jpg` ?...
3. 如果原文件已有数字后缀，则递增该数?
   - `photo_001.jpg` ?`photo_002.jpg`
   - `photo_1.jpg` ?`photo_2.jpg`
4. 最大尝试次数：1000（超过则报错?

**实现逻辑?*
```bash
# 生成唯一文件?
generate_unique_name() {
    local base_name="$1"
    local extension="$2"
    local counter=1

    while [ -f "$目标路径/$base_name$extension" ]; do
        base_name="${原文件名%.*}_${counter}"
        ((counter++))
        if [ $counter -gt 1000 ]; then
            echo "错误：无法生成唯一文件名（已尝?000次）"
            return 1
        fi
    done

    echo "${base_name}${extension}"
}
```

**选项4：询问用?*
```
目标文件 "images/photo.jpg" 已存?
请选择?
1) 跳过
2) 覆盖
3) 自动重命名为 "photo_1.jpg"
```

**实现逻辑?*
```bash
# 检查目标文件是否存?
if [ -f "$目标路径/$新文件名" ]; then
    case $冲突处理方式 in
        "跳过") 跳过该文?;;
        "覆盖") 覆盖该文?;;
        "自动重命?) 生成新文件名 ;;
        "询问") 询问用户选择 ;;
    esac
fi
```

## 输出结果

### 成功?
- 显示整理前后的目录对?
- 列出所有分类文件夹及其包含的文件数?
- 提供操作摘要统计

### 示例输出
```
文件整理完成?

源目录：/path/to/source
目标目录?path/to/target

整理结果?
├── images (5 个文?
?  ├── photo_001.jpg
?  ├── photo_002.jpg
?  └── ...
├── documents (8 个文?
?  ├── report.pdf
?  └── ...
└── others (2 个文?

总计?5 个文件已复制?3 个分类文件夹
```

## 使用示例

### 示例1：按扩展名分类（保持原文件名?
```
用户：帮我整理这个文件夹里的文件，按类型分类
执行?
1. 创建 images/, documents/, videos/, audio/, archives/, code/, others/ 文件?
2. ?.jpg/.png/.gif 复制?images/
3. ?.pdf/.docx/.txt 复制?documents/
4. ?.mp4/.avi 复制?videos/
5. ?.mp3/.wav 复制?audio/
6. ?.zip/.rar 复制?archives/
7. ?.py/.js/.html 复制?code/
8. 其余文件复制?others/
```

### 示例2：按修改日期分类
```
用户：按修改日期整理文件，按月分?
执行?
1. 检查文件修改时?
2. 创建嵌套目录?023/12/, 2024/01/, 2024/02/...
3. 将文件复制到对应?月文件夹?
   - report.pdf (修改?2024-01-15) ?2024/01/
   - photo.jpg (修改?2023-12-20) ?2023/12/
   - data.txt (修改?2024-02-01) ?2024/02/
```

### 示例3：按日期时间戳重命名（使用文件修改时间）
```
用户：整理文件并加上文件修改时间?
系统：请问使用文件修改时间还是当前时间？
用户：文件修改时?
执行?
1. 获取文件修改时间：report.pdf (2024-01-15 14:30:22)
2. 创建 organized_files 文件?
3. 重命名为：report_20240115_143022.pdf
```

### 示例4：按大小分类并重命名（分类独立编号）
```
用户：把大文件和小文件分开，并加上序号
系统：请问使用全局编号还是分类独立编号?
用户：分类独立编?
执行?
1. 按文件大小创建分类文件夹：tiny/, small/, medium/, large/, huge/
2. 复制文件到对应分?
3. 每个分类内独立编号：
   - tiny/file_001.txt
   - tiny/file_002.json
   - small/file_001.pdf
   - large/file_001.zip
```

### 示例5：按文件名前缀分类（下划线分隔?
```
用户：按文件名前缀分类
执行?
1. 提取文件名前缀（按下划线分隔）
2. 创建对应前缀文件?
3. 复制文件?
   - photo_001.jpg ?photo/
   - photo_002.jpg ?photo/
   - document.pdf ?document/
   - report_2024.pdf ?report/
   - data_backup.zip ?data/
```

### 示例6：按文件名首字母分类
```
用户：按文件名首字母 A-Z 分类
执行?
1. 按首字母创建文件夹：A/, B/, C/, ... , Z/, 0-9/, others/
2. 复制文件?
   - apple.txt ?A/
   - banana.pdf ?B/
   - 123data.json ?0-9/
   - _hidden.txt ?others/
```

### 示例7：日期时间戳 + 序号重命?
```
用户：整理文件，重命名格式：原文件名_时间戳_序号
执行?
1. 复制文件并重命名?
   - report.pdf ?report_20240128_143022_001.pdf
   - data.xlsx ?data_20240128_143023_002.xlsx
   - photo.jpg ?photo_20240128_143024_003.jpg
```

### 示例8：文件冲突处理（自动重命名，递增已有数字?
```
用户：整理文件，冲突时自动重命名
源文件：
- photo.jpg
- photo_1.jpg
- photo_2.jpg
- photo_003.jpg

执行?
1. 检测目标文件存在情?
2. 生成唯一名称?
   - photo.jpg ?photo_4.jpg (跳过 1, 2, 003)
   - photo_1.jpg ?photo_5.jpg
   - photo_2.jpg ?photo_6.jpg
   - photo_003.jpg ?photo_007.jpg (补零对齐)
```

### 示例9：移动模?+ 覆盖
```
用户：整理到 backup，使用移动模式，遇到冲突直接覆盖
执行?
?警告：已选择"移动+覆盖"模式，重复文件将被永久删除！
请确认：y/n
用户：y

1. 使用 mv 命令移动文件
2. 如果目标文件已存在，直接覆盖
3. 原文件将被删?

结果?
?report.pdf ?backup/documents/report.pdf（已覆盖?
?data.xlsx ?backup/documents/data.xlsx
```

### 示例10：按季度分类
```
用户：按季度整理文件
执行?
1. 检查文件修改时?
2. 创建文件夹：2024/Q1/, 2024/Q2/, 2024/Q3/, 2024/Q4/
3. 复制文件?
   - report.pdf (2024-02-15) ?2024/Q1/
   - data.xlsx (2024-05-20) ?2024/Q2/
   - photo.jpg (2024-08-10) ?2024/Q3/
   - backup.zip (2024-11-30) ?2024/Q4/
```
